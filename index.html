<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Ã‡arkÄ± - Pro</title>
    
    <!-- React ve ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Konfeti Efekti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                solanaPurple: '#9945FF',
                solanaGreen: '#14F195',
                darkBg: '#0F172A',
              },
              animation: {
                'spin-slow': 'spin 10s linear infinite',
                'pulse-glow': 'pulseGlow 2s infinite',
              },
              keyframes: {
                pulseGlow: {
                  '0%, 100%': { boxShadow: '0 0 20px rgba(153, 69, 255, 0.4)' },
                  '50%': { boxShadow: '0 0 40px rgba(20, 241, 149, 0.6)' },
                }
              }
            }
          }
        }
      </script>
    
    <!-- Solana Web3.js -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

    <style>
        body {
            background: radial-gradient(circle at center, #1e1e2e 0%, #000000 100%);
            color: white;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        /* Modern Grid Arka Plan */
        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -1;
            mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
        }

        .wheel-rotate {
            transition: transform 6s cubic-bezier(0.15, 0.85, 0.15, 1); /* Daha gerÃ§ekÃ§i sÃ¼rtÃ¼nme */
        }

        /* Dilim AyraÃ§larÄ± */
        .wheel-separator {
            position: absolute;
            top: 0; 
            left: 50%;
            width: 1px;
            height: 50%;
            background: rgba(255,255,255,0.3);
            transform-origin: bottom center;
            z-index: 10;
        }

        /* Cam Panel */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { Connection, PublicKey, Transaction, SystemProgram, clusterApiUrl, LAMPORTS_PER_SOL } = solanaWeb3;

        // --- AYARLAR ---
        const SOLANA_NETWORK = 'mainnet-beta'; 
        const SPIN_COST = 0.01; 
        const HOUSE_ADDRESS = "CTD6awXNUksKhCFcZX8Ubst2ANxioUUNX1iRbhTYKxby";

        // Dilimler - Renkler ve YazÄ±lar Optimize Edildi
        const SEGMENTS = [
            { label: "2 SOL",   value: 2,    color: "#FFD700", textColor: "#000", type: "win", weight: 1 },    // AltÄ±n
            { label: "KAYIP",   value: 0,    color: "#EF4444", textColor: "#FFF", type: "lose", weight: 30 },  // KÄ±rmÄ±zÄ±
            { label: "0.1 SOL", value: 0.1,  color: "#8B5CF6", textColor: "#FFF", type: "win", weight: 8 },    // Mor
            { label: "BOÅž",     value: 0,    color: "#64748B", textColor: "#FFF", type: "lose", weight: 25 },  // Gri
            { label: "1 SOL",   value: 1,    color: "#F59E0B", textColor: "#000", type: "win", weight: 2 },    // Turuncu
            { label: "TEKRAR",  value: 0,    color: "#DC2626", textColor: "#FFF", type: "lose", weight: 20 },  // Koyu KÄ±rmÄ±zÄ±
            { label: "0.05 SOL", value: 0.05, color: "#10B981", textColor: "#FFF", type: "win", weight: 10 },  // YeÅŸil
            { label: "ÅžANSSIZ", value: 0,   color: "#475569", textColor: "#FFF", type: "lose", weight: 4 },    // Koyu Gri
        ];

        // Ses Efektleri
        const playClickSound = () => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(100, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, ctx.currentTime + 0.05);
            gain.gain.setValueAtTime(0.05, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.start();
            osc.stop(ctx.currentTime + 0.05);
        };

        const playWinSound = () => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            [0, 0.1, 0.2, 0.4].forEach((t, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.value = 523.25 + (i * 100); 
                gain.gain.setValueAtTime(0.1, ctx.currentTime + t);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + t + 0.5);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start(ctx.currentTime + t);
                osc.stop(ctx.currentTime + t + 0.5);
            });
        };

        const getProvider = () => {
            if ('phantom' in window) {
                const provider = window.phantom?.solana;
                if (provider?.isPhantom) return provider;
            }
            return window.solana?.isPhantom ? window.solana : null;
        };

        function App() {
            const [walletAddress, setWalletAddress] = React.useState(null);
            const [balance, setBalance] = React.useState(null); 
            const [isSpinning, setIsSpinning] = React.useState(false);
            const [rotation, setRotation] = React.useState(0);
            const [status, setStatus] = React.useState({ type: 'info', msg: 'BaÅŸlamak iÃ§in cÃ¼zdan baÄŸla.' });
            const [history, setHistory] = React.useState([]);
            const [soundEnabled, setSoundEnabled] = React.useState(true);

            const connection = new Connection(clusterApiUrl(SOLANA_NETWORK), 'confirmed');

            const connectWallet = async () => {
                const provider = getProvider();
                if (provider) {
                    try {
                        const resp = await provider.connect();
                        const pubKey = resp.publicKey.toString();
                        setWalletAddress(pubKey);
                        setStatus({ type: 'success', msg: 'HazÄ±rsÄ±n! Ã‡arkÄ± Ã§evir.' });
                        fetchBalance(resp.publicKey);
                    } catch (err) {
                        setStatus({ type: 'error', msg: 'BaÄŸlantÄ± iptal edildi.' });
                    }
                } else {
                    window.open("https://phantom.app/", "_blank");
                }
            };

            const fetchBalance = async (publicKey) => {
                try {
                    const bal = await connection.getBalance(publicKey);
                    setBalance(bal / LAMPORTS_PER_SOL);
                } catch (err) {
                    console.error("Bakiye hatasÄ±:", err);
                    setBalance(null); 
                }
            };

            const handleSpin = async () => {
                if (!walletAddress || isSpinning) return;
                
                const provider = getProvider();
                if (!provider) return;

                setStatus({ type: 'process', msg: 'CÃ¼zdan onayÄ± bekleniyor...' });

                try {
                    const sender = new PublicKey(walletAddress);
                    const receiver = new PublicKey(HOUSE_ADDRESS); 

                    const transaction = new Transaction().add(
                        SystemProgram.transfer({
                            fromPubkey: sender,
                            toPubkey: receiver, 
                            lamports: Math.round(SPIN_COST * LAMPORTS_PER_SOL),
                        })
                    );

                    let blockhash;
                    try {
                         const latest = await connection.getLatestBlockhash();
                         blockhash = latest.blockhash;
                    } catch(e) {
                        setStatus({ type: 'error', msg: 'AÄŸ hatasÄ±, tekrar dene.' });
                        return;
                    }
                    
                    transaction.recentBlockhash = blockhash;
                    transaction.feePayer = sender;

                    const signedTransaction = await provider.signTransaction(transaction);
                    const signature = await connection.sendRawTransaction(signedTransaction.serialize());
                    
                    setStatus({ type: 'process', msg: 'Bol ÅŸans! ðŸŽ¡' });
                    startWeightedSpin();
                    
                    setTimeout(() => fetchBalance(sender), 3000);

                } catch (error) {
                    console.error("Hata:", error);
                    if (error.message?.includes("User rejected")) {
                        setStatus({ type: 'error', msg: 'Ä°ÅŸlemi onaylamadÄ±n.' });
                    } else {
                        setStatus({ type: 'error', msg: 'Hata oluÅŸtu, tekrar dene.' });
                    }
                }
            };

            const startWeightedSpin = () => {
                setIsSpinning(true);
                
                const totalWeight = SEGMENTS.reduce((sum, seg) => sum + seg.weight, 0);
                let randomNum = Math.random() * totalWeight;
                let selectedIndex = 0;
                for (let i = 0; i < SEGMENTS.length; i++) {
                    if (randomNum < SEGMENTS[i].weight) {
                        selectedIndex = i;
                        break;
                    }
                    randomNum -= SEGMENTS[i].weight;
                }

                // DÃ¶nÃ¼ÅŸ HesabÄ±: Ä°bre 12 yÃ¶nÃ¼nde (0 derece). 
                // SeÃ§ilen dilimin orta noktasÄ± (index * 45 + 22.5) ibreye gelmeli.
                // Bunun iÃ§in Ã§arkÄ± (360 - (index * 45 + 22.5)) kadar dÃ¶ndÃ¼rmeliyiz (mod 360).
                // Ãœzerine ekstra turlar ekliyoruz.
                
                const segmentCenter = selectedIndex * 45 + 22.5; 
                const stopAngle = 360 - segmentCenter; // Ä°breye denk gelecek aÃ§Ä±
                
                // Biraz rastgelelik (tam ortaya deÄŸil, saÄŸa sola da gelebilir)
                const fuzziness = (Math.random() - 0.5) * 30; // +/- 15 derece
                
                const extraSpins = 360 * 8; // 8 tam tur
                const targetRotation = rotation + extraSpins + (stopAngle - (rotation % 360)) + fuzziness;

                // ModÃ¼lasyon dÃ¼zeltmesi (Negatif veya geri dÃ¶nÃ¼ÅŸ olmasÄ±n)
                // Mevcut rotasyondan daima ileri gitmeli
                const finalRotation = Math.max(targetRotation, rotation + 360 * 5); 

                setRotation(finalRotation);

                // TÄ±kÄ±rtÄ± Sesi
                let clickInterval;
                if (soundEnabled) {
                     let count = 0;
                     clickInterval = setInterval(() => {
                        playClickSound();
                        count++;
                        if(count > 25) clearInterval(clickInterval);
                     }, 150);
                }

                setTimeout(() => {
                    setIsSpinning(false);
                    calculateResult(selectedIndex);
                }, 6000);
            };

            const calculateResult = (index) => {
                const result = SEGMENTS[index];
                setHistory(prev => [result, ...prev].slice(0, 5));

                if (result.type === 'win') {
                    setStatus({ type: 'win', msg: `ðŸŽ‰ ${result.label} KAZANDIN!` });
                    if(soundEnabled) playWinSound();
                    confetti({
                        particleCount: 150,
                        spread: 80,
                        origin: { y: 0.6 },
                        colors: ['#9945FF', '#14F195', '#FFD700'],
                        zIndex: 9999
                    });
                } else {
                    setStatus({ type: 'lose', msg: `${result.label}. Tekrar dene!` });
                }
            };

            return (
                <div className="flex flex-col items-center justify-center min-h-screen p-4 relative text-sm sm:text-base selection:bg-solanaPurple selection:text-white">
                    
                    {/* Header */}
                    <div className="w-full max-w-xl flex justify-between items-center mb-8 p-4 glass-panel rounded-2xl z-20">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-gradient-to-br from-solanaPurple to-solanaGreen rounded-xl flex items-center justify-center shadow-lg transform rotate-3 hover:rotate-0 transition">
                                <span className="text-xl font-bold text-white">â—Ž</span>
                            </div>
                            <div>
                                <h1 className="text-xl font-black text-white leading-none tracking-tight">SOLANA</h1>
                                <span className="text-xs font-bold text-solanaGreen tracking-widest">Ã‡ARKI</span>
                            </div>
                        </div>
                        
                        {!walletAddress ? (
                            <button onClick={connectWallet} className="bg-gradient-to-r from-solanaPurple to-purple-600 hover:to-solanaPurple text-white px-6 py-2.5 rounded-xl font-bold transition-all shadow-[0_0_20px_rgba(153,69,255,0.4)] hover:shadow-[0_0_30px_rgba(153,69,255,0.6)] transform hover:-translate-y-0.5">
                                CÃ¼zdan BaÄŸla
                            </button>
                        ) : (
                            <div className="flex items-center gap-3">
                                <div className="text-right px-3 py-1 bg-black/20 rounded-lg border border-white/5">
                                    <div className="text-[10px] text-slate-400 font-bold uppercase">Bakiye</div>
                                    <div className="font-mono text-solanaGreen font-bold text-lg leading-none">
                                        {balance === null ? "..." : balance.toFixed(3)}
                                    </div>
                                </div>
                                <button onClick={() => setSoundEnabled(!soundEnabled)} className="w-10 h-10 flex items-center justify-center bg-slate-800/50 hover:bg-slate-700 rounded-lg text-slate-400 hover:text-white transition border border-white/5">
                                    {soundEnabled ? "ðŸ”Š" : "ðŸ”‡"}
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Ã‡ark AlanÄ± */}
                    <div className="relative mb-10 z-10 scale-90 sm:scale-100">
                        {/* Ä°bre (Ä°nce ÃœÃ§gen) */}
                        <div className="absolute -top-12 left-1/2 transform -translate-x-1/2 z-30 filter drop-shadow-xl">
                            <div className="w-8 h-20 bg-gradient-to-b from-yellow-300 via-yellow-500 to-orange-700 clip-path-polygon-[50%_100%,_0_0,_100%_0]"></div>
                        </div>

                        {/* Ã‡ark Ã‡erÃ§evesi */}
                        <div className="absolute -inset-4 rounded-full bg-gradient-to-b from-slate-700 to-slate-900 shadow-2xl border border-slate-600 z-0"></div>
                        
                        {/* Ã‡arkÄ±n Kendisi */}
                        <div className="w-[20rem] h-[20rem] sm:w-[24rem] sm:h-[24rem] rounded-full border-[6px] border-slate-800 overflow-hidden shadow-[inset_0_0_40px_rgba(0,0,0,0.6)] bg-slate-900 relative z-10">
                            <div 
                                className="w-full h-full rounded-full wheel-rotate relative"
                                style={{ 
                                    transform: `rotate(${rotation}deg)`,
                                    background: `conic-gradient(
                                        ${SEGMENTS[0].color} 0deg 45deg,
                                        ${SEGMENTS[1].color} 45deg 90deg,
                                        ${SEGMENTS[2].color} 90deg 135deg,
                                        ${SEGMENTS[3].color} 135deg 180deg,
                                        ${SEGMENTS[4].color} 180deg 225deg,
                                        ${SEGMENTS[5].color} 225deg 270deg,
                                        ${SEGMENTS[6].color} 270deg 315deg,
                                        ${SEGMENTS[7].color} 315deg 360deg
                                    )`
                                }}
                            >
                                {/* Dilimler */}
                                {SEGMENTS.map((seg, i) => (
                                    <React.Fragment key={i}>
                                        {/* AyraÃ§ */}
                                        <div className="wheel-separator" style={{ transform: `rotate(${i * 45}deg)` }}></div>
                                        
                                        {/* YazÄ± AlanÄ± */}
                                        <div 
                                            className="absolute w-full h-full top-0 left-0"
                                            style={{ transform: `rotate(${i * 45 + 22.5}deg)` }}
                                        >
                                            {/* YazÄ±yÄ± merkeze deÄŸil, dÄ±ÅŸa doÄŸru hizalamak iÃ§in trick */}
                                            <div className="absolute top-0 left-1/2 -translate-x-1/2 pt-6 sm:pt-10 text-center">
                                                <div 
                                                    className="font-black text-sm sm:text-base uppercase tracking-wider drop-shadow-md whitespace-nowrap"
                                                    style={{ 
                                                        color: seg.textColor,
                                                        // YazÄ±yÄ± dikleÅŸtirmek yerine yatay tutuyoruz ama okunaklÄ± olsun diye
                                                        // ArtÄ±k yazÄ± dilimin iÃ§ine "oturuyor"
                                                    }}
                                                >
                                                    {seg.label}
                                                </div>
                                                {seg.type === 'win' && (
                                                    <div className="text-[9px] font-bold opacity-80" style={{ color: seg.textColor }}>KAZAN</div>
                                                )}
                                            </div>
                                        </div>
                                    </React.Fragment>
                                ))}
                            </div>
                            
                            {/* Parlama Efekti */}
                            <div className="absolute inset-0 rounded-full bg-gradient-to-tr from-white/10 to-transparent pointer-events-none"></div>

                            {/* Orta GÃ¶bek */}
                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-20 h-20 bg-gradient-to-br from-slate-100 to-slate-300 rounded-full flex items-center justify-center border-[4px] border-slate-400 shadow-[0_10px_20px_rgba(0,0,0,0.5)] z-20">
                                <div className="w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center border border-slate-600">
                                    <span className="text-2xl animate-pulse">ðŸ’Ž</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Durum MesajÄ± */}
                    <div className={`mb-6 px-8 py-4 rounded-2xl border-2 text-center font-bold w-full max-w-sm transition-all duration-300 shadow-xl z-20 ${
                        status.type === 'error' ? 'bg-red-950/90 border-red-500/50 text-red-100' :
                        status.type === 'win' ? 'bg-green-900/90 border-green-400/50 text-green-100 scale-105' :
                        status.type === 'process' ? 'bg-blue-950/90 border-blue-500/50 text-blue-100 animate-pulse' :
                        'glass-panel text-slate-300 border-slate-700'
                    }`}>
                        {status.msg}
                    </div>

                    {/* Ã‡evir Butonu */}
                    <button 
                        onClick={handleSpin}
                        disabled={!walletAddress || isSpinning}
                        className={`
                            relative group w-full max-w-xs px-8 py-5 rounded-2xl font-black text-xl transition-all duration-300 transform shadow-2xl z-20 overflow-hidden
                            ${!walletAddress 
                                ? 'bg-slate-800 text-slate-600 cursor-not-allowed border border-slate-700' 
                                : isSpinning 
                                    ? 'bg-slate-700 text-slate-500 cursor-wait border border-slate-600'
                                    : 'bg-gradient-to-r from-solanaPurple to-solanaGreen hover:scale-[1.02] text-white hover:shadow-solanaGreen/30 active:scale-95 border-t border-white/20'
                            }
                        `}
                    >
                        {/* Buton IÅŸÄ±ltÄ±sÄ± */}
                        <div className="absolute inset-0 -translate-x-full group-hover:animate-[shimmer_1.5s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent z-10"></div>
                        
                        <span className="relative z-20 flex items-center justify-center gap-2">
                            {isSpinning ? 'DÃ–NÃœYOR...' : (
                                <>
                                    Ã‡EVÄ°R <span className="bg-black/20 px-2 py-0.5 rounded text-sm font-bold opacity-80">{SPIN_COST} SOL</span>
                                </>
                            )}
                        </span>
                    </button>
                    
                    {/* GeÃ§miÅŸ */}
                    {history.length > 0 && (
                        <div className="mt-8 flex gap-3 z-10">
                            {history.map((h, i) => (
                                <div key={i} className={`
                                    w-10 h-10 rounded-xl flex items-center justify-center text-xs font-bold border shadow-lg transition-all hover:scale-110 cursor-help
                                    ${h.type === 'win' ? 'bg-green-500/20 border-green-500 text-green-400' : 'bg-red-500/20 border-red-500 text-red-400'}
                                `} title={h.label}>
                                    {h.type === 'win' ? 'W' : 'L'}
                                </div>
                            ))}
                        </div>
                    )}
                    
                    <div className="mt-8 text-xs text-slate-500 font-medium uppercase tracking-widest opacity-60">
                         MAINNET BETA
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
